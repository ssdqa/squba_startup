<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />



<title>Connecting to Your Data</title>

<script>// Pandoc 2.9 adds attributes on both header and div. We remove the former (to
// be compatible with the behavior of Pandoc < 2.8).
document.addEventListener('DOMContentLoaded', function(e) {
  var hs = document.querySelectorAll("div.section[class*='level'] > :first-child");
  var i, h, a;
  for (i = 0; i < hs.length; i++) {
    h = hs[i];
    if (!/^h[1-6]$/i.test(h.tagName)) continue;  // it should be a header h1-h6
    a = h.attributes;
    while (a.length > 0) h.removeAttribute(a[0].name);
  }
});
</script>

<style type="text/css">
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
</style>



<style type="text/css">
code {
white-space: pre;
}
.sourceCode {
overflow: visible;
}
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
{ counter-reset: source-line 0; }
pre.numberSource code > span
{ position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
{ content: counter(source-line);
position: relative; left: -1em; text-align: right; vertical-align: baseline;
border: none; display: inline-block;
-webkit-touch-callout: none; -webkit-user-select: none;
-khtml-user-select: none; -moz-user-select: none;
-ms-user-select: none; user-select: none;
padding: 0 4px; width: 4em;
color: #aaaaaa;
}
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa; padding-left: 4px; }
div.sourceCode
{ }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } 
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.at { color: #7d9029; } 
code span.bn { color: #40a070; } 
code span.bu { color: #008000; } 
code span.cf { color: #007020; font-weight: bold; } 
code span.ch { color: #4070a0; } 
code span.cn { color: #880000; } 
code span.co { color: #60a0b0; font-style: italic; } 
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.do { color: #ba2121; font-style: italic; } 
code span.dt { color: #902000; } 
code span.dv { color: #40a070; } 
code span.er { color: #ff0000; font-weight: bold; } 
code span.ex { } 
code span.fl { color: #40a070; } 
code span.fu { color: #06287e; } 
code span.im { color: #008000; font-weight: bold; } 
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.kw { color: #007020; font-weight: bold; } 
code span.op { color: #666666; } 
code span.ot { color: #007020; } 
code span.pp { color: #bc7a00; } 
code span.sc { color: #4070a0; } 
code span.ss { color: #bb6688; } 
code span.st { color: #4070a0; } 
code span.va { color: #19177c; } 
code span.vs { color: #4070a0; } 
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } 
</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    var j = 0;
    while (j < rules.length) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") {
        j++;
        continue;
      }
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') {
        j++;
        continue;
      }
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>




<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; } 
code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">Connecting to Your Data</h1>



<p>In order to use each of the packages in the SQUBA ecosystem, you must
first be able to connect to your CDM formatted data in the database
where it is stored. We have included a helper function that will allow
you to more easily set up this connection and provide the package with
the information it needs to execute the analyses.</p>
<div id="initialize_dq_session" class="section level2">
<h2>initialize_dq_session</h2>
<p><code>initialize_dq_session</code> is the helper function included in
the <code>squba.gen</code> package and accessible through all other
SQUBA ecosystem packages. This function will intake user-specific
database connection information and use these to set up internal
configurations that will allow the data quality analyses to run.</p>
<p>We use a framework called <code>argos</code> to facilitate accessing
the data, so it is <strong>required</strong> to establish a connection
via this function. This ensures that all internal functions and
configurations are appropriately established without a need from the
user to directly interact with this framework. More information on
<code>argos</code> can be found <a href="https://github.com/PEDSnet/argos">here</a>.</p>
<p>A standard set up of <code>initialize_dq_session</code> may look
something like this:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="fu">library</span>(conceptsetdistribution)</span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a><span class="fu">initialize_dq_session</span>(<span class="at">session_name =</span> <span class="st">&#39;vignette_demo&#39;</span>,</span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a>                      <span class="at">db_conn =</span> dbi_connection <span class="sc">/</span> <span class="st">&#39;path/to/json/config&#39;</span>, <span class="co">#choose one</span></span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a>                      <span class="at">is_json =</span> <span class="cn">FALSE</span> <span class="sc">/</span> <span class="cn">TRUE</span>, <span class="co">#choose one</span></span>
<span id="cb1-6"><a href="#cb1-6" tabindex="-1"></a>                      <span class="at">working_directory =</span> <span class="fu">getwd</span>(),</span>
<span id="cb1-7"><a href="#cb1-7" tabindex="-1"></a>                      <span class="at">file_subdirectory =</span> <span class="st">&#39;my_files&#39;</span>,</span>
<span id="cb1-8"><a href="#cb1-8" tabindex="-1"></a>                      <span class="at">cdm_schema =</span> <span class="st">&#39;my_cdm_schema&#39;</span>)</span></code></pre></div>
</div>
<div id="parameter-walkthrough" class="section level2">
<h2>Parameter Walkthrough</h2>
<div id="session_name" class="section level3">
<h3><strong>session_name</strong></h3>
<p>This is an arbitrary string value used to give a name to your
session. It is used for internal organization, so that multiple sessions
can more easily be differentiated.</p>
</div>
<div id="db_conn-is_json" class="section level3">
<h3><strong>db_conn</strong> &amp; <strong>is_json</strong></h3>
<p>These parameters are where the actual database connection information
is read into the function. There are two methods that can be used to
input the connection details.</p>
<div id="option-1-dbi-or-similar" class="section level4">
<h4>Option 1: DBI (or similar)</h4>
<p>One option is to create a connection object inside your R session
using <code>DBI</code> or a similar database connection package.
Instructions for how to use <code>DBI::dbConnect</code> to establish a
connection can be found in <a href="https://dbi.r-dbi.org/articles/DBI.html">the DBI package
documentation</a>.</p>
<p>If this option is used, <code>is_json</code> should be set to
<strong>FALSE</strong>.</p>
</div>
<div id="option-2-external-json-configuration" class="section level4">
<h4>Option 2: External JSON Configuration</h4>
<p>Another option is to store your configuration details in a local JSON
file and provide the helper function with a path to that file. We have
provided a simple example below. As with Option 1, the type of
information that would be included in the file differs for different
database backends.</p>
<pre><code>{
    &quot;src_name&quot; : &quot;Postgres&quot;,
    &quot;src_args&quot; : {
            &quot;host&quot;     : &quot;my.database.server&quot;,
            &quot;port&quot;     : 5432,
            &quot;dbname&quot;   : &quot;project_db&quot;,
            &quot;username&quot; : &quot;my_username&quot;,
            &quot;password&quot; : &quot;my_password&quot;,
            &quot;options&quot;  : &quot;-c search_path=my_cdm_schema&quot;
     },
     &quot;post_connect_sql&quot; : [
         &quot;set role project_staff;&quot;
     ]
     
}
</code></pre>
<p>If this option is used <code>is_json</code> should be set to
<strong>TRUE</strong>.</p>
</div>
</div>
<div id="working_directory-file_subdirectory" class="section level3">
<h3><strong>working_directory</strong> &amp;
<strong>file_subdirectory</strong></h3>
<p>These parameters provide information about your local directory so
the analyses know where local files such as concept sets or input
configuration files can be accessed. When using a project-oriented
workflow in R, <code>getwd()</code> will default to the directory of
your project. Otherwise, you will need to point to the directory of
interest.</p>
<p><code>file_subdirectory</code> should be a directory nested inside of
the provided <code>working_directory</code> where local files are
stored. This ensures that all concept sets are accessible to the code
without the user having to explicitly define file paths multiple times
throughout the analysis process.</p>
</div>
<div id="cdm_schema" class="section level3">
<h3><strong>cdm_schema</strong></h3>
<p>This should be the name of the schema (or database, depending on your
local setup) where the data in the appropriate CDM format (either OMOP
or PCORnet) is stored. Any supplemental tables that you may want to
access for the analyses should also be stored here</p>
</div>
<div id="optional-parameters" class="section level3">
<h3>Optional Parameters</h3>
<p>This function has some additional parameters that can optionally be
specified should you so choose.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a></span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a><span class="fu">initialize_dq_session</span>(<span class="at">session_name =</span> <span class="st">&#39;vignette_demo&#39;</span>,</span>
<span id="cb3-3"><a href="#cb3-3" tabindex="-1"></a>                      <span class="at">db_conn =</span> dbi_connection <span class="sc">/</span> <span class="st">&#39;path/to/json/config&#39;</span>, <span class="co">#choose one</span></span>
<span id="cb3-4"><a href="#cb3-4" tabindex="-1"></a>                      <span class="at">is_json =</span> <span class="cn">FALSE</span> <span class="sc">/</span> <span class="cn">TRUE</span>, <span class="co">#choose one</span></span>
<span id="cb3-5"><a href="#cb3-5" tabindex="-1"></a>                      <span class="at">working_directory =</span> <span class="fu">getwd</span>(),</span>
<span id="cb3-6"><a href="#cb3-6" tabindex="-1"></a>                      <span class="at">file_subdirectory =</span> <span class="st">&#39;my_files&#39;</span>,</span>
<span id="cb3-7"><a href="#cb3-7" tabindex="-1"></a>                      <span class="at">cdm_schema =</span> <span class="st">&#39;my_cdm_schema&#39;</span>,</span>
<span id="cb3-8"><a href="#cb3-8" tabindex="-1"></a>                      <span class="at">results_schema =</span> <span class="st">&#39;my_results_schema&#39;</span>, <span class="sc">**</span><span class="er">*</span></span>
<span id="cb3-9"><a href="#cb3-9" tabindex="-1"></a>                      <span class="at">results_tag =</span> <span class="st">&#39;_project_id&#39;</span>, <span class="sc">**</span><span class="er">*</span></span>
<span id="cb3-10"><a href="#cb3-10" tabindex="-1"></a>                      <span class="at">vocabulary_schema =</span> <span class="st">&#39;vocabulary&#39;</span> <span class="sc">**</span><span class="er">*</span></span>
<span id="cb3-11"><a href="#cb3-11" tabindex="-1"></a>                      )</span></code></pre></div>
<div id="results_schema" class="section level4">
<h4><strong>results_schema</strong></h4>
<p>If you would like to output any of your analysis results back to the
database, this string will define the destination schema. The
<code>output_tbl</code> function included as part of the
<code>argos</code> framework can be used to achieve this.</p>
</div>
<div id="results_tag" class="section level4">
<h4><strong>results_tag</strong></h4>
<p>This is an optional string that would be appended on to any tables
output back to the database in the defined <code>results_schema</code>.
This is intended to assist with uniquely identifying tables for each
project/analysis and avoid accidental overwrites.</p>
</div>
<div id="vocabulary_schema" class="section level4">
<h4><strong>vocabulary_schema</strong></h4>
<p>If you have the OMOP vocabulary tables available on your database and
would like to access them as part of the analysis, this is where you
would define the schema in which those tables are stored.</p>
<p>This parameter will primarily be used for OMOP database backends, but
can be used for PCORnet backends if the same or similar tables are
available.</p>
</div>
</div>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
